<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√≠nh Ti·ªÅn Tr·ªç</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 450px; }
        
        /* V√πng ch·ª•p ·∫£nh h√≥a ƒë∆°n */
        #captureArea { background: white; padding: 15px; border-radius: 10px; }

        h2 { text-align: center; color: #1a73e8; margin-bottom: 25px; text-transform: uppercase; margin-top: 0; }
        
        .row { display: flex; gap: 15px; margin-bottom: 15px; }
        .col { flex: 1; }
        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 13px; color: #444; }
        
        .input-style { 
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; 
            box-sizing: border-box; font-size: 16px; background: #f9f9f9;
        }

        .result-box { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px; border: 1px solid #e1e4e8; }
        .result-line { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 15px; border-bottom: 1px solid #eee; padding-bottom: 4px; }
        .total-price { font-size: 24px; color: #d93025; font-weight: bold; text-align: center; margin-top: 15px; padding-top: 10px; border-top: 2px dashed #ccc; }
        
        /* N√∫t t·∫£i ·∫£nh */
        .download-btn {
            width: 100%; background-color: #1a73e8; color: white; border: none; padding: 15px;
            border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; margin-bottom: 20px; transition: 0.3s;
        }
        .download-btn:hover { background-color: #1557b0; }

        .highlight { font-weight: bold; color: #1a73e8; }
    </style>
</head>
<body>

<div class="container">
    <button class="download-btn" onclick="taiHoaDon()">üì∏ T·∫¢I ·∫¢NH H√ìA ƒê∆†N R√ï N√âT</button>

    <div id="captureArea">
        <h2>T√çNH TI·ªÄN TR·ªå</h2>
        
        <div class="row">
            <div class="col">
                <label>S·ªê PH√íNG</label>
                <input type="text" id="soPhong" class="input-style" placeholder="01" oninput="tinhToan()">
            </div>
            <div class="col">
                <label>S·ªê NG∆Ø·ªúI M·∫†NG</label>
                <input type="number" id="soNguoiMang" class="input-style" placeholder="0" oninput="tinhToan()">
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label>ƒêI·ªÜN (M·ªöI - C≈®)</label>
                <div style="display: flex; gap: 5px;">
                    <input type="number" id="dienMoi" class="input-style" placeholder="M·ªõi" oninput="tinhToan()">
                    <input type="number" id="dienCu" class="input-style" placeholder="C≈©" oninput="tinhToan()">
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label>N∆Ø·ªöC (M·ªöI - C≈®)</label>
                <div style="display: flex; gap: 5px;">
                    <input type="number" id="nuocMoi" class="input-style" placeholder="M·ªõi" oninput="tinhToan()">
                    <input type="number" id="nuocCu" class="input-style" placeholder="C≈©" oninput="tinhToan()">
                </div>
            </div>
        </div>

        <div class="result-box">
            <div class="result-line"><span>Ph√≤ng:</span> <span id="resPhong" class="highlight">...</span></div>
            <div class="result-line"><span>Ti·ªÅn ph√≤ng:</span> <span>600,000 ƒë</span></div>
            <div class="result-line"><span>M·∫°ng (30k/ng):</span> <span id="resMang">0</span> ƒë</div>
            <div class="result-line"><span>V·ªá sinh:</span> <span>5,000 ƒë</span></div>
            <div class="result-line">
                <span>ƒêi·ªán (<span id="chuDien" class="highlight">0</span> s·ªë x 4k):</span> 
                <span><b id="resDien">0</b> ƒë</span>
            </div>
            <div class="result-line">
                <span>N∆∞·ªõc (<span id="chuNuoc" class="highlight">0</span> kh·ªëi x 12k):</span> 
                <span><b id="resNuoc">0</b> ƒë</span>
            </div>
            <div class="total-price">T·ªîNG: <span id="resTong">0</span> VNƒê</div>
        </div>
    </div>
</div>

<script>
    function tinhToan() {
        const GIA_PHONG = 600000, GIA_MANG = 30000, GIA_VS = 5000, GIA_DIEN = 4000, GIA_NUOC = 12000;

        let soPhong = document.getElementById('soPhong').value || "...";
        let soNguoi = parseInt(document.getElementById('soNguoiMang').value) || 0;
        let dMoi = parseFloat(document.getElementById('dienMoi').value) || 0;
        let dCu = parseFloat(document.getElementById('dienCu').value) || 0;
        let nMoi = parseFloat(document.getElementById('nuocMoi').value) || 0;
        let nCu = parseFloat(document.getElementById('nuocCu').value) || 0;

        let hDien = Math.max(0, dMoi - dCu);
        let hNuoc = Math.max(0, nMoi - nCu);

        let tMang = soNguoi * GIA_MANG;
        let tDien = hDien * GIA_DIEN;
        let tNuoc = hNuoc * GIA_NUOC;
        let tong = GIA_PHONG + GIA_VS + tMang + tDien + tNuoc;

        document.getElementById('resPhong').innerText = soPhong;
        document.getElementById('chuDien').innerText = hDien;
        document.getElementById('chuNuoc').innerText = hNuoc;
        document.getElementById('resMang').innerText = tMang.toLocaleString();
        document.getElementById('resDien').innerText = tDien.toLocaleString();
        document.getElementById('resNuoc').innerText = tNuoc.toLocaleString();
        document.getElementById('resTong').innerText = tong.toLocaleString();
    }

    async function taiHoaDon() {
        const area = document.getElementById('captureArea');
        const inputs = area.querySelectorAll('input');
        
        // T·∫°o hi·ªáu ·ª©ng t·∫°m th·ªùi ƒë·ªÉ ch·ª•p ·∫£nh r√µ n√©t
        const originalDisplays = [];
        inputs.forEach(input => {
            const span = document.createElement('span');
            span.innerText = input.value || "0";
            span.style.cssText = "font-size:16px; padding:12px; display:inline-block; border:1px solid #ddd; border-radius:8px; width:100%; background:#f9f9f9; box-sizing:border-box;";
            
            originalDisplays.push({input, span});
            input.style.display = 'none';
            input.parentNode.insertBefore(span, input);
        });

        html2canvas(area, { 
            scale: 3, 
            backgroundColor: "#ffffff" 
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = `HoaDon_Phong_${document.getElementById('soPhong').value || '01'}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();

            // Kh√¥i ph·ª•c l·∫°i c√°c √¥ input
            originalDisplays.forEach(({input, span}) => {
                input.style.display = 'block';
                span.remove();
            });
        });
    }
</script>

</body>
</html>
